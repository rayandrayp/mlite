<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=0.1">
    <title>{$title} - {$settings.nama_instansi}</title>
    <link rel="icon" href="{?=url()?}/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="{?=url(MODULES)?}/anjungan/css/bootstrap.min.css">
    <link href="{?=url()?}/assets/css/font-awesome.css" rel="stylesheet">
    <link href="{?=url(MODULES)?}/anjungan/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <link href="{?=url(MODULES)?}/anjungan/css/jquery-ui.min.css" rel="stylesheet">
    <link href="{?=url(MODULES)?}/anjungan/css/keyboard.css" rel="stylesheet">
    <style media="screen">
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: #0264d6;
            margin: 0;
            height: calc(100vh);
            width: 100%;
        }
        
        .modal-full {
            min-width: 100%;
            margin: 0;
        }
        
        .modal-full .modal-content {
            min-height: 100vh;
        }
        
        .modal-fix {
            min-width: 1024px;
            margin: 0;
        }
        
        .modal-fix .modal-content {
            min-height: 100vh;
        }
        
        .modal .tab-content {
            min-height: 50vh;
        }
        
        .nav-pills.nav-wizard>li {
            position: relative;
            overflow: visible;
            border-right: 8px solid transparent;
            border-left: 8px solid transparent;
        }
        
        .nav-pills.nav-wizard>li+li {
            margin-left: 0;
        }
        
        .nav-pills.nav-wizard>li:first-child {
            border-left: 0;
        }
        
        .nav-pills.nav-wizard>li:first-child a {
            border-radius: 5px 0 0 5px;
        }
        
        .nav-pills.nav-wizard>li:last-child {
            border-right: 0;
        }
        
        .nav-pills.nav-wizard>li:last-child a {
            border-radius: 0 5px 5px 0;
        }
        
        .nav-pills.nav-wizard>li a {
            border-radius: 0;
            background-color: #eee;
        }
        
        .nav-pills.nav-wizard>li:not(:last-child) a:after {
            position: absolute;
            content: "";
            top: 0px;
            right: -20px;
            width: 0px;
            height: 0px;
            border-style: solid;
            border-width: 20px 0 20px 20px;
            border-color: transparent transparent transparent #eee;
            z-index: 150;
        }
        
        .nav-pills.nav-wizard>li:not(:first-child) a:before {
            position: absolute;
            content: "";
            top: 0px;
            left: -20px;
            width: 0px;
            height: 0px;
            border-style: solid;
            border-width: 20px 0 20px 20px;
            border-color: #eee #eee #eee transparent;
            z-index: 150;
        }
        
        .nav-pills.nav-wizard>li:hover:not(:last-child) a:after {
            border-color: transparent transparent transparent #aaa;
        }
        
        .nav-pills.nav-wizard>li:hover:not(:first-child) a:before {
            border-color: #aaa #aaa #aaa transparent;
        }
        
        .nav-pills.nav-wizard>li:hover a {
            background-color: #aaa;
            color: #fff;
        }
        
        .nav-pills.nav-wizard>li:not(:last-child) a.active:after {
            border-color: transparent transparent transparent #428bca;
        }
        
        .nav-pills.nav-wizard>li:not(:first-child) a.active:before {
            border-color: #428bca #428bca #428bca transparent;
        }
        
        .nav-pills.nav-wizard>li a.active {
            background-color: #428bca;
        }
        
        div.ui-keyboard {
            z-index: 2000;
        }
        
        footer {
            position: fixed;
            right: 0px;
            bottom: 0px;
            height: 40px;
            width: calc(100% - 0px);
            font-size: 14px;
            color: #fff;
        }
        
        footer a,
        footer a:hover {
            color: #fff;
        }
        
        .my-custom-scrollbar {
            position: relative;
            height: 200px;
            overflow: auto;
        }
        
        .table-wrapper-scroll-y {
            display: block;
        }
        
        .keypad-popup,
        .keypad-inline,
        .keypad-key,
        .keypad-special {
            font-size: 30px;
        }
        
        .keypad-special {
            width: 4.25em;
            margin: 0.125em;
        }
        
        .keypad-spacebar {
            width: 13.25em;
            margin: 0.125em;
        }
        
        .keypad-key,
        .keypad-tab,
        .keypad-space {
            width: 2em;
            margin: 0.125em;
        }
        
        .keypad-half-space {
            width: 1em;
            margin-left: 0.125em;
        }
        /* css used to override the definitions above */
        div.ui-widget {
        font-size: 2em;
        }
        button.ui-keyboard-button {
        margin: 2px;
        }
    </style>
</head>

<body>
    <div class="mx-auto text-center text-white">
        <img src="{?=url()?}/{$logo}" width="150"><br>
        <h3 class="display-6">Anjungan Pasien Mandiri Pelayanan Rawat Jalan</h3>
        <h2 class="display-5">{$settings.nama_instansi}</h2>
    </div>

    <br><br>
    <div class="container">
        <div class="card-deck mb-3 text-center">
            <div class="card mb-6 shadow-sm" data-toggle="modal" data-target="#antrian">
                <div class="card-body btn btn-lg btn-success">
                    <ul class="list-unstyled mt-3 mb-4">
                        <span style="font-size: 100px; color: white;"><i class="fa fa-question"></i></span>
                    </ul>
                    <a href="#" style="text-decoration: none; color: white;">
                        <h1 class="display-5">PASIEN</h1>
                        <h1 class="display-5">BARU</h1>
                    </a>
                </div>
            </div>
            <div class="card mb-6 shadow-sm" data-toggle="modal" data-target="#daftar">
                <div class="card-body btn btn-lg btn-primary">
                    <ul class="list-unstyled mt-3 mb-4">
                        <span style="font-size: 100px; color: white;"><i class="fa fa-stethoscope"></i></span>
                    </ul>
                    <h1 class="display-5">PASIEN</h1>
                    <h1 class="display-5">LAMA</h1>
                </div>
            </div>
            <div class="card mb-6 shadow-sm" data-toggle="modal" data-target="#checkin">
                <div class="card-body btn btn-lg btn-danger">
                    <ul class="list-unstyled mt-3 mb-4">
                        <span style="font-size: 100px; color: white;"><i class="fa fa-user-md"></i></span>
                    </ul>
                    <h1 class="display-5">CHECK-IN</h1>
                    <h1 class="display-5">MOBILE JKN</h1>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="pricing-header mt-5 px-3 py-3 pt-md-3 pb-md-2 mx-auto text-center text-danger bg-white">
        <h3 class="display-6">
            <marquee>{$running_text}</marquee>
        </h3>
    </div>

    <footer class="visible-lg visible-md bg-primary" style="padding:10px;z-index:1000;">
        <div class="canvas">
            <p class="pull-right">
                Made with <i class="fa fa-heart text-danger"></i> by <a href="https://basoro.id/" target="_blank"><b>drg. F. Basoro</b>.</a> {$powered}.
            </p>
            <p><i class="fa fa-fw fa-calendar"></i> <span>{$tanggal}</span> <i class="fa fa-fw fa-clock-o"></i><span id="clock"></span> <i class="fa fa-fw fa-user"></i> <span>{?= sprintf('Login sebagai <strong>%s</strong>', $username) ?}</span></p>
        </div>
    </footer>

    <!-- Modal Antrian -->
    <div class="modal fade" id="antrian" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Antrian Loket</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="padding-top:30px;">
                    <div class="row justify-content-around">
                        <div class="col-6 pt-3 pb-x3">
                            <div id="printAntrianLoket" style="display: none;" class="cetak">
                                <div style="width: 200px; font-family: Tahoma; margin-top: 10px; margin-right: 5px; margin-bottom: 100px; margin-left: 15px; font-size: 21px !important;border: 0px solid #000;">
                                    <p style="font-size:12px;" align="center">{$settings.nama_instansi}<br><span class="small">{$settings.alamat}<br>Telp: {$settings.nomor_telepon}</span></p>
                                    <hr>
                                    <div id="print_nomor_loket"></div>
                                    <p align="center">Loket Pendaftaran</p>
                                </div>
                            </div>
                            <div id="display_nomor_loket"></div>
                            <form role="form" id="formloket" name="formloket">
                                <button type="submit" class="btn btn-lg btn-danger btn-block" style="padding: 30px;font-size:42px;" id="btnKRM" value="Submit" name="btnKRM" onclick="printDiv('printAntrianLoket');">ANTRIAN LOKET</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Daftar -->
    <div class="modal fade" id="daftar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Pendaftaran Pasien BPJS/ Non-BPJS</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="javascript:window.location=`{?=url('anjungan/pasien')?}`" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-pills nav-wizard" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#infoPanel" role="tab">No. BPJS/NIK</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#poli" role="tab">Pilih Poli dan Dokter</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#reviewPrint" role="tab">Cetak</a>
                        </li>
                    </ul>

                    <div class="tab-content mt-2">
                        <div class="tab-pane fade show active" id="infoPanel" role="tabpanel">
                            <h4>Data Rekam Medik</h4>
                            <div class="form-group">
                                <label for="campaignName">Pilih Kepesertaan</label>
                                <select class="form-control" id="selectkepesertaan">
                                  <option value="-" selected="true" disabled="true">-</option>
                                  <option value="bpjs">BPJS</option>
                                  <option value="nonbpjs">Non-BPJS</option>
                                </select>
                            </div>
                            <div class="d-none" id="partbpjs">
                                <div class="form-group">
                                    <label for="campaignName">Nomor Kartu BPJS</label>
                                    <input type="text" class="form-text form-control form-control-lg nobpjs" id="no_bpjs" value="" placeholder="Nomor Kartu BPJS"></input>
                                </div>
                            </div>
                            <div class="d-none" id="partnonbpjs">
                                <div class="form-group">
                                    <label for="campaignName">Nomor Induk Kependudukan (NIK)</label>
                                    <input type="text" class="form-text form-control form-control-lg noktp" id="no_ktp" value="" placeholder="Nomor Induk Kependudukan (NIK)"></input>
                                </div>
                            </div>

                            <button class="btn btn-secondary" id="cekNomor">Cek Nomor</button>

                            <div class="d-none" id="messageDiv">
                                <div class="form-group">
                                    <label for="message" id="messageText" style="color: rgb(223, 0, 0);"></label>
                                </div>
                            </div>

                            <div class="table-wrapper-scroll-y my-custom-scrollbar d-none" id="tabelRujukanDiv">
                                <table class="table table-bordered table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Nomor Rujukan</th>
                                            <th scope="col">Nomor SEP</th>
                                            <th scope="col">Tanggal SEP</th>
                                            <th scope="col">Poli</th>
                                            <th scope="col">Pilih</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelRujukan">

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="tab-pane fade" id="poli" role="tabpanel">
                            <h4>Informasi Pribadi, Klinik dan Dokter Tujuan</h4>
                            <div class="form-row">
                                <div class="col form-group">
                                    <label>Nomor Rekam Medik</label>
                                    <input type="text" name="no_rkm_medis_daftar" class="form-control" placeholder="" id="no_rkm_medis_daftar" disabled>
                                </div>
                                <div class="col form-group">
                                    <label>Nama Lengkap</label>
                                    <input type="text" name="nm_pasien_daftar" class="form-control" placeholder=" " id="nm_pasien_daftar" disabled>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col form-group">
                                    <label>Nomor BPJS</label>
                                    <input type="text" name="no_bpjs_daftar" class="form-control" placeholder="" id="no_bpjs_daftar" disabled>
                                </div>
                                <div class="col form-group">
                                    <label>Nomor Rujukan</label>
                                    <input type="text" name="no_rujukan" class="form-control" placeholder="" id="no_rujukan" disabled>
                                </div>
                                <div class="col form-group d-none">
                                    <label>Nomor Induk Kependudukan</label>
                                    <input type="text" name="nik" class="form-control" placeholder="" id="nik" disabled>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Alamat Lengkap</label>
                                <textarea class="form-control" placeholder="" id="alamat_daftar" disabled></textarea>
                            </div>
                            <div class="form-row">
                                <div class="col form-group">
                                    <label>Cara Bayar</label>
                                    <select class="form-control" name="kd_pj" id="kd_pj">
                                      <option value="" selected >Pilih Cara Bayar</option>
                                      {loop: $penjab}
                                      <option value="{$value.kd_pj}">{$value.png_jawab}</option>
                                      {/loop}
                                    </select>
                                </div>
                                <div class="col form-group">
                                    <label>Tanggal Kunjungan</label>
                                    <input type="text" class="form-control" name="datepicker" id="tgl_registrasi_daftar" placeholder="">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col form-group">
                                    <label>Kode Poli</label>
                                    <select id="pilih_poli_daftar" class="form-control">
                                      <option value="">Pilih Poli</option>
                                    </select>
                                </div>
                                <div class="col form-group">
                                    <label>Kode Dokter</label>
                                    <select id="pilih_dokter_daftar" class="form-control">
                                      <option value="">Pilih Dokter</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-secondary" id="finish">Simpan Pendaftaran</button>
                            <div class="d-none" id="messageDivSimpan">
                                <div class="form-group">
                                    <label for="message" id="messageTextSimpan" style="color: rgb(223, 0, 0);"></label>
                                </div>
                            </div>
                        </div>

                        <!-- Print area -->
                        <div class="tab-pane fade" id="reviewPrint" role="tabpanel">
                            <h4>Cetak Bukti Daftar</h4>
                            <div style="width: 200px; font-family: Tahoma; margin: 0 auto; font-size: 11px !important;">
                                <div class="block-header">
                                    <div style="font-size:11px; font-weight: bold; text-align: center;">
                                        {$settings.nama_instansi}<br>
                                        <br> {$settings.nomor_telepon}
                                        <br>
                                        <hr> BUKTI PENDAFTARAN<br> ANJUNGAN PASIEN MANDIRI<br>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div style="width: 70px; display: inline-block;">Kodebooking</div>: <span id="kdbooking_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Tanggal</div>: <span id="tgl_registrasi_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">No. Rujukan </div>: <span id="no_rujukan_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">No. RM</div>: <span id="no_rkm_medis_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Nama</div>: <span id="nm_pasien_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Klinik</div>: <span id="nm_poli_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Dokter</div>: <span id="nm_dokter_cetak"></span><br>
                            <div style="text-align: center;">
                                <hr> Pendaftaran berhasil disimpan. Terimakasih telah menggunakan anjungan Pasien Mandiri.<br> Silahkan menuju poli terkait dan simpanlah bukti cetak pendaftaran ini untuk ditunjukkan ke petugas poli.<br>
                                <hr> Bawalah surat rujukan atau surat kontrol asli. Tetap pakai masker dan patuhi protokol kesehatan.<br><br>
                            </div>

                            <div id="printDaftar" style="display: none;" class="cetak">
                                <section style="margin: 1px; width: 200px; font-family: Tahoma; font-size: 11px !important;">
                                    <div class="block-header">
                                        <div style="font-size:13px; font-weight: bold; text-align: center;">
                                            {$settings.nama_instansi}<br>
                                        </div>
                                        <div style="font-size:11px; text-align: center;">
                                            {$settings.nomor_telepon}<br>
                                        </div>
                                        <div style="font-size:12px; font-weight: bold; text-align: center;">
                                            <hr> ANJUNGAN PASIEN MANDIRI <br><br> No. Antrian<br>
                                        </div>
                                        <div style="font-size:40px; font-weight: bold; text-align: center;">
                                            <span id="no_reg_final"></span><br>
                                        </div>
                                    </div>
                                    <br>
                                    <div style="width: 70px; display: inline-block;">Kodebooking </div>:<span id="kdbooking_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Tanggal </div>:<span id="tgl_registrasi_final"> - <span id="jam_reg_final"></span> </span><br>
                                    <div style="width: 70px; display: inline-block;">No. Rujukan </div>: <span id="no_rujukan_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Nama </div>: <span id="nm_pasien_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">No. RM </div>: <span id="no_rkm_medis_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Poli </div>: <span id="nm_poli_final"></span><br>

                                    <div style="text-align: center;">
                                        <hr> Terimakasih telah menggunakan anjungan Pasien Mandiri.<br> Silahkan menuju poli terkait dan simpan bukti cetak pendaftaran.<br>
                                        <hr> Tetap pakai masker dan patuhi protokol kesehatan.<br><br>
                                    </div>
                                </section>
                            </div>
                            <button class="btn btn-primary btn-block" onclick="printDiv('printDaftar');">Cetak</button>
                        </div>
                    </div>

                    <div class="progress mt-5">
                        <div class="progress-bar" role="progressbar" style="width: 35%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Step 1 of 3</div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="javascript:window.location=`{?=url('anjungan/pasien')?}`">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Checkin -->
    <div class="modal fade" id="checkin" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Checkin Pasien Mobile-JKN</h5>
                    <button type="button" class="close" data-dismiss="modal" onclick="javascript:window.location=`{?=url('anjungan/pasien')?}`" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-pills nav-wizard" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#infoPanel" role="tab">Kodebooking</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#reviewPrintCheckin" role="tab">Cetak</a>
                        </li>
                    </ul>

                    <div class="tab-content mt-2">
                        <div class="tab-pane fade show active" id="infoPanel" role="tabpanel">
                            <h4>Kodebooking</h4>
                            <div class="form-group">
                                <label for="campaignName">Masukkan kodebooking yang didapatkan dari Mobile-JKN</label>
                                <input type="text" class="form-text form-control form-control-lg kdbooking" id="no_kodebooking" value="" placeholder="Nomor Kodebooking"></input>
                            </div>
                            <button class="btn btn-secondary" id="checkin">Check-in Sekarang</button>
                        </div>

                        <!-- Print area -->
                        <div class="tab-pane fade" id="reviewPrintCheckin" role="tabpanel">
                            <h4>Cetak Bukti Daftar</h4>
                            <div style="width: 200px; font-family: Tahoma; margin: 0 auto; font-size: 11px !important;">
                                <div class="block-header">
                                    <div style="font-size:12px; font-weight: bold; text-align: center;">
                                        {$settings.nama_instansi}<br> {$settings.alamat}
                                        <br> {$settings.nomor_telepon}
                                        <br>
                                        <hr> BUKTI PENDAFTARAN<br> ANJUNGAN PASIEN MANDIRI<br>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div style="width: 70px; display: inline-block;">No. Kodebooking</div>: <span id="checkin_kdbooking_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Tanggal</div>: <span id="checkin_tgl_registrasi_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">No. Rujukan </div>: <span id="checkin_no_rujukan_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">No. RM</div>: <span id="checkin_no_rkm_medis_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Nama</div>: <span id="checkin_nm_pasien_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Klinik</div>: <span id="checkin_nm_poli_cetak"></span><br>
                            <div style="width: 70px; display: inline-block;">Dokter</div>: <span id="checkin_nm_dokter_cetak"></span><br>
                            <div style="text-align: center;">
                                <hr> Terima Kasih Atas kepercayaan Anda.<br> Bawalah kartu Berobat anda dan datang 30 menit sebelumnya.<br>
                                <hr> Bawalah surat rujukan atau surat kontrol asli dan tunjukkan pada petugas di Lobby resepsionis.<br><br>
                            </div>

                            <div id="printCheckin" style="display: none;" class="cetak">
                                <section style="margin: 20px; width: 170px; font-family: Tahoma; font-size: 11px !important;">
                                    <div class="block-header">
                                        <div style="font-size:13px; font-weight: bold; text-align: center;">
                                            {$settings.nama_instansi}<br>
                                        </div>
                                        <div style="font-size:11px; text-align: center;">
                                            {$settings.nomor_telepon}<br>
                                        </div>
                                        <div style="font-size:12px; font-weight: bold; text-align: center;">
                                            <hr> ANJUNGAN PASIEN MANDIRI <br><br> No. Antrian<br>
                                        </div>
                                        <div style="font-size:40px; font-weight: bold; text-align: center;">
                                            <span id="no_reg_final"></span><br>
                                        </div>
                                    </div>
                                    <br>
                                    <div style="width: 70px; display: inline-block;">No. Kodebooking </div>:<span id="checkin_kdbooking_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Tanggal </div>:<span id="checkin_tgl_registrasi_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Antrian </div>: <span id="checkin_no_reg_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">No. Rujukan </div>: <span id="checkin_no_rujukan_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Nama </div>: <span id="checkin_nm_pasien_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">No. RM </div>: <span id="checkin_no_rkm_medis_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Alamat </div>: <span id="checkin_alamat_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Ruang </div>: <span id="checkin_nm_poli_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Dokter </div>: <span id="checkin_nm_dokter_final"></span><br>
                                    <div style="width: 70px; display: inline-block;">Cara Bayar </div>: <span id="checkin_cara_bayar_final"></span><br>

                                    <div style="text-align: center;">
                                        <hr> Terima Kasih Atas kepercayaan Anda.<br> Bawalah kartu Berobat anda dan datang 30 menit sebelumnya.<br>
                                        <hr> Bawalah surat rujukan atau surat kontrol asli dan tunjukkan pada petugas di Lobby resepsionis.<br><br>
                                    </div>
                                </section>
                            </div>
                            <button class="btn btn-primary btn-block" onclick="printDiv('printCheckin');">Cetak</button>
                        </div>
                    </div>

                    <div class="progress mt-5">
                        <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Step 1 of 2</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="javascript:window.location=`{?=url('anjungan/pasien')?}`">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Kontrol -->
    <div class="modal fade" id="kontrol" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Cetak Surat Kontrol</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div>
                        <div class="form-group">
                            <input type="text" class="form-control form-control-lg" id="norm" placeholder="Nomor Kartu Berobat">
                        </div>
                        <div class="form-group">
                            <select class="form-control form-control-lg" name="kd_poli" id="kdpoli">
                              <option value="" selected >-- Pilih poliklinik --</option>
                              {loop: $poliklinik}
                              <option value="{$value.kd_poli}">{$value.nm_poli}</option>
                              {/loop}
                            </select>
                        </div>
                        <div class="get-content" style="display: none;">
                            <br>
                            <h4>Antrian Kontrol</h4>
                            <br>
                            <p>No RM: <span id="no_rkm_medis"></span></p>
                            <p>Tanggal Kontrol: <span id="tanggal_datang"></span></p>
                            <p>Klinik Tujuan: <span id="nm_poli"></span></p>
                            <br><br>
                            <button type="button" class="btn btn-lg btn-danger" onclick="printDiv('printSKDP');">Cetak</button>
                        </div>
                        <div id="printSKDP" style="display: none;" class="cetak">
                            <div style="width: 180px; font-family: Tahoma; margin-top: 10px; margin-right: 5px; margin-bottom: 100px; margin-left: 15px; font-size: 11px !important;">
                                <h4>Surat Kontrol (SKDP)</h4>
                                <div style="width: 50px; display: inline-block;">No. Surat</div>: <span id="c_no_antrian"></span><br>
                                <hr>
                                <div style="width: 50px; display: inline-block;">Tanggal</div>: <span id="c_tanggal_datang"></span><br>
                                <div style="width: 50px; display: inline-block;">Antrian</div>: <span id="c_no_reg"></span><br>
                                <div style="width: 50px; display: inline-block;">No. RM</div>: <span id="c_no_rkm_medis"></span><br>
                                <div style="width: 50px; display: inline-block;">Nama</div>: <span id="c_nm_pasien"></span><br>
                                <div style="width: 50px; display: inline-block;">Diagnosa</div>: <span id="c_diagnosa"></span><br>
                                <div style="width: 50px; display: inline-block;">Terapi</div>: <span id="c_terapi"></span><br>
                                <div style="width: 50px; display: inline-block;">Klinik</div>: <span id="c_nm_poli"></span><br>
                                <div style="width: 50px; display: inline-block;">Dokter</div>: <span id="c_nm_dokter"></span><br>

                                <div style="text-align: center;">
                                    <hr> Terima Kasih Atas kepercayaan Anda.<br> Bawalah kartu Berobat anda dan datang 30 menit sebelumnya.<br>
                                    <hr> Bawalah surat rujukan atau surat kontrol asli dan tunjukkan pada petugas di Lobby resepsionis.<br><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-lg btn-secondary" data-dismiss="modal">Tutup</button>
                    <button type="submit" id="getNoRM" class="btn btn-lg btn-primary">Cek Surat Kontrol</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <script src="{?=url(MODULES)?}/anjungan/js/jquery.min.js"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/popper.min.js"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/bootstrap.min.js"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/gijgo.min.js" type="text/javascript"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/jquery-ui-custom.min.js"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/jquery.keyboard.js"></script>
    <script src="{?=url(MODULES)?}/anjungan/js/jquery.mousewheel.js"></script>
    <script>
        // $(document).ready(function(){
        //   $('#getNoRM').on('click',function(){
        //     var no_rkm_medis = $('#norm').val();
        //     var kd_poli = $('#kdpoli').val();
        //     $.ajax({
        //       type:'POST',
        //       url:'{?=url()?}/anjungan/ajax?show=get-skdp',
        //       dataType: "json",
        //       data: {no_rkm_medis:no_rkm_medis, kd_poli:kd_poli},
        //       success:function(data){
        //         if(data.status == 'ok'){
        //           $('#no_rkm_medis').text(data.result.no_rkm_medis);
        //           $('#tanggal_datang').text(data.result.tanggal_datang);
        //           $('#nm_poli').text(data.result.nm_poli);
        //           $('#c_no_rkm_medis').text(data.result.no_rkm_medis);
        //           $('#c_nm_pasien').text(data.result.nm_pasien);
        //           $('#c_diagnosa').text(data.result.diagnosa);
        //           $('#c_terapi').text(data.result.terapi);
        //           $('#c_alasan1').text(data.result.alasan1);
        //           $('#c_alasan2').text(data.result.alasan2);
        //           $('#c_rtl1').text(data.result.rtl1);
        //           $('#c_rtl2').text(data.result.rtl2);
        //           $('#c_tanggal_datang').text(data.result.tanggal_datang);
        //           $('#c_tanggal_rujukan').text(data.result.tanggal_rujukan);
        //           $('#c_no_antrian').text(data.result.no_antrian);
        //           $('#c_nm_dokter').text(data.result.nm_dokter);
        //           $('#c_nm_poli').text(data.result.nm_poli);
        //           $('#c_no_reg').text(data.result.no_reg);
        //           $('.get-content').slideDown();
        //         }else{
        //           $('.get-content').slideUp();
        //           alert("Surat kontrol tidak ditemukan...");
        //         }
        //       }
        //     });
        //   });
        // });

        function parseDate(str) {
            var mdy = str.split('-');
            return new Date(mdy[0], mdy[1]-1, mdy[2]);
        }

        function datediff(first, second) {
            // Take the difference between the dates and divide by milliseconds per day.
            // Round to nearest whole number to deal with DST.
            // console.log('second '+(second)); 
            // console.log('first '+(first)); 
            // console.log('diff '+(second-first)); 
            return Math.round((second-first)/(1000*60*60*24));
        }
        $(document).ready(function() {
            setTimeout(function() {
                $("#display_nomor_loket").load("{?=url()?}/anjungan/ajax?show=tampilloket");
                $("#print_nomor_loket").load("{?=url()?}/anjungan/ajax?show=printloket");
            }, 3000);
            // setInterval(function(){
            //   $("#display_nomor_loket").load("{?=url()?}/anjungan/ajax?show=tampilloket");
            //   $("#print_nomor_loket").load("{?=url()?}/anjungan/ajax?show=printloket");
            // }, 1000);
        })

        function printDiv(eleId) {
            var PW = window.open('', '_blank', 'Print content');
            PW.document.write(document.getElementById(eleId).innerHTML);
            PW.document.close();
            PW.focus();
            PW.print();
            PW.close();
            window.location.href = "{?=url('anjungan/pasien')?}";
        }
        function checkNoSEP(no_sep){
            var valid = '';
            $.ajax({
                type: 'POST',
                url: '{?=url()?}/anjungan/ajax?show=check-nosep',
                dataType: "json",
                data: {
                    no_sep: no_sep
                },
                success: function(data) {
                    if (data.status == 'ok') {
                        valid = 'false';
                        console.log('check1 ' + valid);
                    } else {
                        valid = 'true';
                        console.log('check2 ' + valid);
                    }
                }
            });

            return valid;
        }
        // function printSEP(eleId){
        //     var PW = window.open('', '_blank', 'Print content');
        //     PW.document.write('<link rel="stylesheet" href="../css/bootstrap.min.css">');
        //     PW.document.write(document.getElementById(eleId).innerHTML);
        //     PW.document.close();
        //     PW.focus();
        //     PW.print();
        //     PW.close();
        //     window.location.href = "{?=url('anjungan/pasien')?}";
        // }

        function getPoli(){
            var no_rkm_medis_daftar = $('#no_rkm_medis_daftar').val();
            var tgl_registrasi_daftar = $('#tgl_registrasi_daftar').val();
            $.ajax({
                type: 'POST',
                url: '{?=url()?}/anjungan/ajax?show=get-poli',
                dataType: "json",
                data: {
                    no_rkm_medis: no_rkm_medis_daftar,
                    tgl_registrasi: tgl_registrasi_daftar
                },
                success: function(data) {
                    if (data.status == 'ok') {
                        $("#pilih_poli_daftar").empty();
                        var div_data = '<option value="" disabled selected="true">Pilih Poli</option>';
                        $.each(data.result, function(i, data) {
                            jam_praktek = data.jam_mulai + "-" + data.jam_selesai;
                            div_data += "<option value='" + data.kd_poli + "'>" + data.nm_poli + "</option>"; //+" (" + jam_praktek + ")" 
                        });
                        $(div_data).appendTo('#pilih_poli_daftar');
                    } else if (data.status == 'exist') {
                        if ($('#selectkepesertaan').val() == 'bpjs') {
                            alert("Anda sudah terdaftar...");
                            window.location.href = "{?=url('anjungan/pasien')?}";
                        } else {
                            $("#pilih_poli_daftar").empty();
                            var div_data = '<option value="" disabled selected="true">Pilih Poli</option>';
                            $.each(data.result, function(i, data) {
                                jam_praktek = data.jam_mulai + "-" + data.jam_selesai;
                                div_data += "<option value='" + data.kd_poli + "'>" + data.nm_poli + "</option>"; //+" (" + jam_praktek + ")" 
                            });
                            $(div_data).appendTo('#pilih_poli_daftar');
                        }
                    } else {
                        alert("Detail poli tidak ditemukan...");
                        document.getElementById("tgl_registrasi_daftar").value = "";
                    }
                }
            });
        }

        $(function() {

            var jsonRujukan;
            var dataRujukanUtama = '';
            var dataRujukanHistori = '';
            var dataRujukan = '';
            var jam_praktek = "";
            // var kodesubspesialis = "";

            $('input[name="datepicker"]').datepicker({
                uiLibrary: 'bootstrap4',
                format: 'yyyy-mm-dd',
                maxDate: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()),
                minDate: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()),
                modal: true,
                change: function(e) {
                    var no_rkm_medis_daftar = $('#no_rkm_medis_daftar').val();
                    var tgl_registrasi_daftar = $('#tgl_registrasi_daftar').val();
                    $.ajax({
                        type: 'POST',
                        url: '{?=url()?}/anjungan/ajax?show=get-poli',
                        dataType: "json",
                        data: {
                            no_rkm_medis: no_rkm_medis_daftar,
                            tgl_registrasi: tgl_registrasi_daftar
                        },
                        success: function(data) {
                            if (data.status == 'ok') {
                                $("#pilih_poli_daftar").empty();
                                var div_data = '<option value="" disabled selected="true">Pilih Poli</option>';
                                $.each(data.result, function(i, data) {
                                    jam_praktek = data.jam_mulai + "-" + data.jam_selesai;
                                    div_data += "<option value='" + data.kd_poli + "'>" + data.nm_poli + "</option>"; //+" (" + jam_praktek + ")" 
                                });
                                $(div_data).appendTo('#pilih_poli_daftar');
                            } else if (data.status == 'exist') {
                                if ($('#selectkepesertaan').val() == 'bpjs') {
                                    alert("Anda sudah terdaftar...");
                                    window.location.href = "{?=url('anjungan/pasien')?}";
                                } else {
                                    $("#pilih_poli_daftar").empty();
                                    var div_data = '<option value="" disabled selected="true">Pilih Poli</option>';
                                    $.each(data.result, function(i, data) {
                                        jam_praktek = data.jam_mulai + "-" + data.jam_selesai;
                                        div_data += "<option value='" + data.kd_poli + "'>" + data.nm_poli + "</option>"; //+" (" + jam_praktek + ")" 
                                    });
                                    $(div_data).appendTo('#pilih_poli_daftar');
                                }
                            } else {
                                alert("Detail poli tidak ditemukan...");
                                document.getElementById("tgl_registrasi_daftar").value = "";
                            }
                        }
                    });
                }
            });

            $('select#pilih_poli_daftar').on('change', function() {
                // var kd_poli_arr = this.value.split(";");
                var kd_poli_daftar = this.value; //kd_poli_arr[0];
                var no_rkm_medis_daftar = $('#no_rkm_medis_daftar').val();
                var tgl_registrasi_daftar = $('#tgl_registrasi_daftar').val();
                $.ajax({
                    type: 'POST',
                    url: '{?=url()?}/anjungan/ajax?show=get-dokter',
                    dataType: "json",
                    data: {
                        no_rkm_medis: no_rkm_medis_daftar,
                        kd_poli: kd_poli_daftar,
                        tgl_registrasi: tgl_registrasi_daftar
                    },
                    success: function(data) {

                        // jsonList = responseJson.list;
                        // console.log(responseJson);
                        // console.log(data.status);

                        if (data.status == 'ok') {
                            var responseJson = JSON.parse(data['response']);
                            $("#pilih_dokter_daftar").empty();
                            // console.log(responseJson.rujukan);
                            // console.log(responseJson['rujukan']);

                            $.each(responseJson, function(i, item) {
                                // kodesubspesialis = item.kodesubspesialis;
                                // console.log(kodesubspesialis);
                                // $("#kodesubspesialis").text(item.kodesubspesialis);
                                var div_data = "<option value='" + item.kodesubspesialis + ";" + item.kodedokter + ";" + item.jadwal + "'>" + item.namadokter + " (" + item.jadwal + ")" + "</option>";
                                $(div_data).appendTo('#pilih_dokter_daftar');
                            });
                            $('#messageTextSimpan').text('');
                            $('#messageDivSimpan').addClass('d-none')
                        } else if (data.status == 'exist') {
                            alert("Anda sudah terdaftar di Poli tersebut...");
                            window.location.href = "{?=url('anjungan/pasien')?}";
                        } else if (data.status == 'limit') {
                            alert("Limit pendaftaran sudah terpenuhi. Silahkan pilih hari lain...");
                            document.getElementById("tgl_registrasi_daftar").value = "";

                        } else if (data.status == 'empty') {
                            $("#pilih_dokter_daftar").empty();
                            alert("Dokter tidak ditemukan...");
                        } else {
                            $("#pilih_dokter_daftar").empty();
                            alert("Dokter tidak ditemukan...");
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(textStatus, errorThrown);
                        $("#pilih_dokter_daftar").empty();
                        console.log("Dokter tidak ditemukan...");
                        $('#messageTextSimpan').text('Dokter tidak ditemukan. Silahkan pilih poli lain.');
                        $('#messageDivSimpan').removeClass('d-none')
                    }
                });
            });

            //simpan pedaftaran
            $('#finish').click(function(e) {
                var value = $('#selectkepesertaan').val();
                var no_peserta = "";
                var no_rujukan_daftar = "";
                var jeniskunjungan;
                var caraBayar = "";

                // if (value == 'bpjs'){//jika pasien BPJS
                no_peserta = $('#no_bpjs_daftar').val();
                no_rujukan_daftar = $('#no_rujukan').val();
                jeniskunjungan = 1; //{1 (Rujukan FKTP), 2 (Rujukan Internal), 3 (Kontrol), 4 (Rujukan Antar RS)} // sementara pakai 1
                // } else {
                //   no_peserta = '-';
                //   no_rujukan_daftar = '';
                //   jeniskunjungan = 1;
                // }

                var no_rkm_medis_daftar = $('#no_rkm_medis_daftar').val();
                var nm_pasien_daftar = $('#nm_pasien_daftar').val();
                var alamat_daftar = $('#alamat_daftar').val();
                var tgl_registrasi_daftar = $('#tgl_registrasi_daftar').val();
                var kd_dokter_field = $('#pilih_dokter_daftar').val();
                var pilih_nm_dokter = $('#pilih_dokter_daftar option:selected').text();
                var nm_dokter = pilih_nm_dokter.substring(0, pilih_nm_dokter.length - 13);
                var kd_dokter_arr = kd_dokter_field.split(";");
                var kodesubspesialis = kd_dokter_arr[0];
                var kd_dokter_daftar = kd_dokter_arr[1];
                var jam_praktek = kd_dokter_arr[2];
                var kd_poli_daftar = $('#pilih_poli_daftar').val();
                var kd_pj = $('#kd_pj').val();
                var nik = $('#nik').val();

                // console.log(kodesubspesialis);
                console.log(nik);
                console.log(no_rkm_medis_daftar);
                console.log(kd_dokter_field);
                // console.log(alamat_daftar);
                // console.log(tgl_registrasi_daftar);
                // console.log(kd_poli_field);
                // console.log(kd_poli_daftar);
                // console.log(kd_dokter_field);
                // console.log(pilih_nm_dokter);
                // console.log(nm_dokter);
                // console.log(jam_praktek);

                $('#no_rkm_medis_cetak').text(no_rkm_medis_daftar);
                $('#no_rujukan_cetak').text(no_rujukan_daftar);
                $('#nm_pasien_cetak').text(nm_pasien_daftar);
                $('#alamat_cetak').text(alamat_daftar);
                $('#tgl_registrasi_cetak').text(tgl_registrasi_daftar);
                $('#kd_poli_cetak').text(kd_poli_daftar);
                $('#kd_dokter_cetak').text(kd_dokter_daftar);
                $('#nm_dokter_cetak').text(nm_dokter);

                $.ajax({
                    url: '{?=url()?}/anjungan/ajax?show=get-namapoli',
                    type: 'POST',
                    dataType: "json",
                    data: {
                        kd_poli: kd_poli_daftar
                    },
                    success: function(data) {
                        if (data.status == 'ok') {
                            $('#nm_poli_cetak').text(data.result.nm_poli);
                        } else {
                            console.log("Error get nama poli.");
                        }
                    }
                });

                // console.log('kd pj '.kd_pj);
                $.ajax({
                    url: '{?=url()?}/anjungan/ajax?show=get-penjab',
                    type: 'POST',
                    dataType: "json",
                    data: {
                        kd_pj: kd_pj ?? 'A09'
                    },
                    success: function(data) {
                        //  console.log(data);
                        if (data.status == 'ok') {
                            caraBayar = data.result.png_jawab;
                        } else {
                            console.log("Error get penanggungjawab.");
                        }
                    }
                });
                //kodesubspesialis: kodesubspesialis,

                $.ajax({
                    url: '{?=url()?}/anjungan/ajax?show=post-registrasi',
                    type: 'POST',
                    dataType: "json",
                    data: {
                        jenis: value,
                        no_rkm_medis_daftar: no_rkm_medis_daftar,
                        nik: nik,
                        tgl_registrasi_daftar: tgl_registrasi_daftar,
                        kd_poli_daftar: kd_poli_daftar,
                        kodesubspesialis: kodesubspesialis,
                        kd_dokter_daftar: kd_dokter_daftar,
                        kd_pj: kd_pj ?? 'A09',
                        jeniskunjungan: jeniskunjungan,
                        no_rujukan_daftar: no_rujukan_daftar,
                        jam_praktek: jam_praktek,
                        no_peserta: no_peserta
                    },
                    success: function(data) {
                        console.log(data);
                        if (data.status == 'ok') {
                            console.log("ok " + data.result);
                            e.preventDefault();
                            console.log("status OK");
                            $('#kdbooking_cetak').text(data.result.nobooking);

                            $('#kdbooking_final').text(data.result.nobooking);
                            $('#tgl_registrasi_final').text(data.result.tgl_registrasi);
                            $('#jam_reg_final').text(data.result.jam_reg);
                            $('#no_reg_final').text(data.result.no_reg);
                            $('#nm_pasien_final').text(data.result.nm_pasien);
                            $('#no_rujukan_final').text(no_rujukan_daftar);
                            $('#no_rkm_medis_final').text(data.result.no_rkm_medis);
                            // $('#alamat_final').text(data.result.alamat);
                            // $('#nm_dokter_final').text(data.result.nm_dokter);
                            $('#nm_poli_final').text(data.result.nm_poli);
                            // $('#cara_bayar_final').text(caraBayar);

                            $('.progress-bar').css('width', '100%');
                            $('.progress-bar').html('Step 3 of 3');
                            $('#myTab a[href="#reviewPrint"]').tab('show');
                        } else {
                            // console.log("err" + data.result);
                            alert(data.result);
                            window.location.href = "{?=url('anjungan/pasien')?}";
                        }
                    }
                });

                setTimeout(function() {
                    window.location.href = "{?=url('anjungan/pasien')?}";
                }, 500000);
            });
            //end of simpan pendaftaran

            //cek nomor BPJS/NIK
            // $('#infoContinue').click(function (e) {
            $('#cekNomor').click(function(e) {
                $('#tabelRujukan tr').remove();
                var value = $('#selectkepesertaan').val();
                var nomor = "";
                dataRujukanUtama = '';
                dataRujukanHistori = '';
                const d = new Date();
                d.setDate(d.getDate() - 90);
                //console.log(value);
                if (value == 'bpjs') { //jika pasien BPJS
                    nomor = $('#no_bpjs').val();
                    var nik = "";
                    var index = 0;
                    var rujukanKosong = false;
                    // console.log(nomor);

                    //get rujukan utama
                    $.ajax({
                        type: 'POST',
                        url: '{?=url()?}/anjungan/ajax?show=check-rujukan2',
                        dataType: "json",
                        data: {
                            no_bpjs: nomor
                        },
                        success: function(data) {
                            // console.log(data);
                            if (data.status == 'ok') {
                                e.preventDefault();
                                var trHTML = '';
                                console.log("rujukan "+data);
                                if(data.rs['response'] == ''){
                                    rujukanKosong = true;
                                } else {
                                    rujukanKosong = false;
                                    var responseRS = JSON.parse(data.rs['response']);
                                    jsonRujukanRS = responseRS.rujukan;
                                    trHTML = '';
                                    $.each(jsonRujukanRS, function(i, item) {
                                        // console.log(item.tglKunjungan.substring(0, 4) + " | " + new Date().getFullYear());
                                        nik = item.peserta.nik;
                                        if (item.tglKunjungan.substring(0, 4) == d.getFullYear() || item.tglKunjungan.substring(0, 4) == new Date().getFullYear()) {
                                            index = i + 1;
                                            console.log(index);
                                            var codebutton = "";
                                            let date_2 = (new Date()).toISOString().split('T')[0];
                                            let TotalDays = datediff(parseDate(item.tglKunjungan), parseDate(date_2));
                                            if (TotalDays > 90) {
                                                codebutton = '<td>Rujukan Tidak Aktif</td>';
                                            } else {
                                                codebutton = '<td><button data-index-rujukan="' + (index - 1) + '" class="btn btn-primary"  type="button">Pilih</button></td>';
                                            }
                                                trHTML += '<tr>' +
                                                    '<th scope="row">' + index + '</th>' +
                                                    '<td>' + item.noKunjungan + '</td>' +
                                                    '<td>' + '-' + '</td>' +
                                                    '<td>' + item.tglKunjungan + '</td>' +
                                                    '<td>' + item.poliRujukan.nama + '</td>' +
                                                    codebutton +
                                                    '</tr>';
                                                dataRujukanUtama += '{"noRujukan":"' + item.noKunjungan + '" , "nik":"' + item.peserta.nik + '"},';
                                            
                                        }
                                    });
                                    // dataRujukanUtama = dataRujukanUtama.substring(0, dataRujukanUtama.length - 1);
                                    console.log("dataRujukanUtama "+dataRujukanUtama);
                                    $('#tabelRujukan').append(trHTML);
                                    $('#tabelRujukanDiv').removeClass('d-none');
                                }

                                if(data.pcare['response'] == ''){
                                    rujukanKosong = true;
                                    dataRujukanUtama = dataRujukanUtama.substring(0, dataRujukanUtama.length - 1);
                                } else {
                                    rujukanKosong = false;
                                    var responsePCARE = JSON.parse(data.pcare['response']);
                                    jsonRujukanPCARE = responsePCARE.rujukan;
                                    trHTML = '';
                                    $.each(jsonRujukanPCARE, function(i, item) {
                                        // console.log(item.tglKunjungan.substring(0, 4) + " | " + new Date().getFullYear());
                                        nik = item.peserta.nik;
                                        if (item.tglKunjungan.substring(0, 4) == d.getFullYear() || item.tglKunjungan.substring(0, 4) == new Date().getFullYear()) {
                                            index = i + 1;
                                            console.log(index);
                                            var codebutton = "";
                                            let date_2 = (new Date()).toISOString().split('T')[0];
                                            let TotalDays = datediff(parseDate(item.tglKunjungan), parseDate(date_2));
                                            if (TotalDays > 90) {
                                                codebutton = '<td>Rujukan Tidak Aktif</td>';
                                            } else {
                                                codebutton = '<td><button data-index-rujukan="' + (index - 1) + '" class="btn btn-primary"  type="button">Pilih</button></td>';
                                            }
                                            trHTML += '<tr>' +
                                                '<th scope="row">' + index + '</th>' +
                                                '<td>' + item.noKunjungan + '</td>' +
                                                '<td>' + '-' + '</td>' +
                                                '<td>' + item.tglKunjungan + '</td>' +
                                                '<td>' + item.poliRujukan.nama + '</td>' +
                                                codebutton +
                                                '</tr>';
                                            dataRujukanUtama += '{"noRujukan":"' + item.noKunjungan + '" , "nik":"' + item.peserta.nik + '"},';
                                        }
                                    });
                                    dataRujukanUtama = dataRujukanUtama.substring(0, dataRujukanUtama.length - 1);
                                    console.log("dataRujukanUtama2 "+dataRujukanUtama);
                                    $('#tabelRujukan').append(trHTML);
                                    $('#tabelRujukanDiv').removeClass('d-none');
                                }
                            } else {
                                $('#messageText').text('Rujukan anda tidak ditemukan');
                                $('#messageDiv').removeClass('d-none');
                            }
                        }
                    });

                    // remarked karena tidak ingin menampilkan rujukan post op
                    //get histori rujukan
                    $.ajax({
                        type: 'POST',
                        url: '{?=url()?}/anjungan/ajax?show=check-rujukan',
                        dataType: "json",
                        data: {
                            no_bpjs: nomor
                        },
                        success: function(data) {
                            console.log(data);
                            if (data.status == 'ok') {
                                rujukanKosong = false;
                                e.preventDefault();
                                var responseJson = JSON.parse(data.result);
                                // jsonhistori = responseJson.histori;
                                // console.log(responseJson.rujukan);
                                console.log("history "+responseJson);
                                // console.log(responseJson['rujukan']);
                                var trHTML = '';
                                // $.each(responseJson, function(i, item) {
                                // console.log(item);
                                    // console.log(item.tglSep.substring(0, 4) + " | " + new Date().getFullYear());
                                    if(responseJson){
                                        $.each(responseJson, function(i, item1) {
                                            if (item1.tglSep.substring(0, 4) == d.getFullYear() || item1.tglSep.substring(0, 4) == new Date().getFullYear()) {
                                            index = index + 1;
                                            let date_2 = (new Date()).toISOString().split('T')[0];
                                            let TotalDays = datediff(parseDate(item1.tglSep), parseDate(date_2));
                                            if (TotalDays > 90) {
                                                codebutton = '<td>Rujukan Tidak Aktif</td>';
                                            } else {
                                                codebutton = '<td><button data-index-rujukan="' + (index - 1) + '" class="btn btn-primary"  type="button">Pilih</button></td>';
                                            }
                                            if(item1.ppkPelayanan == 'RS SOEPRAOEN') {
                                                trHTML += '<tr>' +
                                                    '<th scope="row">' + index + '</th>' +
                                                    '<td>' + item1.noRujukan + '</td>' +
                                                    '<td>' + item1.noSep + '</td>' +
                                                    '<td>' + item1.tglSep + '</td>' +
                                                    '<td>' + item1.poli + '</td>' +
                                                    codebutton +
                                                    '</tr>';
                                                dataRujukanHistori += '{"noRujukan":"' + item1.noRujukan + '" , "nik":"' + nik + '"},';
                                            }
                                        }
                                    });

                                        
                                    }
                                // });
                                dataRujukanHistori = dataRujukanHistori.substring(0, dataRujukanHistori.length - 1);
                                console.log("dataRujukanHistori "+dataRujukanHistori);
                                $('#tabelRujukan').append(trHTML);
                                $('#tabelRujukanDiv').removeClass('d-none');
                            } else {
                                $('#messageText').text('Rujukan anda tidak ditemukan');
                                $('#messageDiv').removeClass('d-none');
                            }
                        }
                    });
                } else if (value == 'nonbpjs') { //jika pasien non-BPJS
                    nomor = $('#no_ktp').val();
                    $.ajax({
                        type: 'POST',
                        url: '{?=url()?}/anjungan/ajax?show=check-nik',
                        dataType: "json",
                        data: {
                            no_ktp: nomor
                        },
                        success: function(data) {
                            if (data.status == 'ok') {
                                e.preventDefault();
                                $('.progress-bar').css('width', '70%');
                                $('.progress-bar').html('Step 2 of 3');
                                $('#myTab a[href="#poli"]').tab('show');
                                $('#no_rkm_medis_daftar').val(data.result.no_rkm_medis);
                                $('#nm_pasien_daftar').val(data.result.nm_pasien);
                                $('#alamat_daftar').val(data.result.alamat);
                                $('#no_bpjs_daftar').val(data.result.no_peserta);
                                $('#no_rujukan').val('-');
                                $('#nik').val(nomor);
                                $('#tgl_registrasi_daftar').val(new Date().toISOString().slice(0, 10));
                                $('#tgl_registrasi_daftar').prop('disabled', 'disabled');
                                $('#kd_pj').val('A09');
                                $('#kd_pj').prop('disabled', 'disabled');
                                getPoli();
                                // $('#kd_pj').prop('disabled', 'disabled');
                            } else {
                                $('#messageText').text('Data NIK anda tidak ditemukan');
                                $('#messageDiv').removeClass('d-none');
                                // window.location.href = "{?=url('anjungan/pasien')?}";
                            }
                        }
                    });
                }
                //console.log(nomor);

                setTimeout(function() {
                    window.location.href = "{?=url('anjungan/pasien')?}";
                }, 500000);

            });
            //end of cek nomor BPJS/NIK

            //jika rujukan dipilih
            $('#tabelRujukan').on('click', 'button.btn', function() {
                let id = $(this).data('index-rujukan');
                console.log('dataRujukanUtama ' + dataRujukanUtama);
                console.log('dataRujukanHistori ' + dataRujukanHistori);
                if (dataRujukanHistori == '') {
                    console.log('2 dataRujukanUtama ' + dataRujukanUtama);
                    dataRujukan = '[' + dataRujukanUtama + ']';
                    jsonRujukan = JSON.parse(dataRujukan);
                } else if (dataRujukanUtama == '') {
                    dataRujukan = '[' + dataRujukanHistori + ']';
                    jsonRujukan = JSON.parse(dataRujukan);
                } else {
                    dataRujukan = '[' + dataRujukanUtama + ',' + dataRujukanHistori + ']';
                    jsonRujukan = JSON.parse(dataRujukan);
                }
                console.log(jsonRujukan);
                console.log('id ' + id);
                var jsonData = jsonRujukan[id];
                var todayDate = new Date().toISOString().slice(0, 10);
                var nomor = $('#no_bpjs').val();
                console.log(jsonData);
                console.log(jsonData.noKartu);

                console.log('nomor rujukan :');
                console.log(jsonData.noRujukan);
                console.log('nik :');
                console.log(jsonData.nik);

                $.ajax({
                    type: 'POST',
                    url: '{?=url()?}/anjungan/ajax?show=get-daftar',
                    dataType: "json",
                    data: {
                        no_peserta: nomor
                    },
                    success: function(data) {
                        if (data.status == 'ok') {
                            //e.preventDefault();
                            $('.progress-bar').css('width', '70%');
                            $('.progress-bar').html('Step 2 of 3');
                            $('#myTab a[href="#poli"]').tab('show');
                            $('#no_rkm_medis_daftar').val(data.result.no_rkm_medis);
                            $('#no_rujukan').val(jsonData.noRujukan);
                            $('#no_bpjs_daftar').val(nomor);
                            $('#nik').val(data.result.no_ktp);
                            $('#nm_pasien_daftar').val(data.result.nm_pasien);
                            $('#alamat_daftar').val(data.result.alamat);
                            $('#tgl_registrasi_daftar').val(todayDate);
                            $('#tgl_registrasi_daftar').prop('disabled', 'disabled');
                            $('#kd_pj').val('BPJ');
                            $('#kd_pj').prop('disabled', 'disabled');
                            getPoli();
                        } else {
                            $('#messageText').text('Data pasien tidak ditemukan. Mohon mendaftarkan diri di loket pendaftaran.');
                            $('#messageDiv').removeClass('d-none');
                        }
                    }
                });
            });

            setTimeout(function() {
                window.location.href = "{?=url('anjungan/pasien')?}";
            }, 500000);



            //selectkepesertaan
            $('select#selectkepesertaan').on('change', function() {
                var value = $(this).val();
                if (value == 'bpjs') {
                    // console.log("BPJS");
                    $("#partbpjs").removeClass('d-none');
                    $("#partnonbpjs").addClass('d-none');
                    $('#messageText').text('');
                    $('#messageDiv').removeClass('d-none');
                    $('#no_ktp').val('');
                } else if (value == 'nonbpjs') {
                    // console.log("Non BPJS");
                    $("#partbpjs").addClass('d-none');
                    $("#tabelRujukanDiv").addClass('d-none');
                    $("#partnonbpjs").removeClass('d-none');
                    $('#messageText').text('');
                    $('#messageDiv').removeClass('d-none');
                    $('#no_bpjs').val('');
                }

            });
            //end of selectkepesertaan

            //checkin
            $('#checkin').click(function(e) {
                var no_kodebooking = $('#no_kodebooking').val();
                var caraBayar = "BPJS";

                $.ajax({
                    type: 'POST',
                    url: '{?=url()?}/anjungan/ajax?show=checkin',
                    dataType: "json",
                    data: {
                        no_kodebooking: no_kodebooking
                    },
                    success: function(data) {
                        if (data.status == 'ok') {
                            // alert("Checkin berhasil.");
                            e.preventDefault();
                            console.log(data);
                            // var no_rujukan = $('#no_rujukan_cetak').val();

                            $('#checkin_kdbooking_cetak').text(no_kodebooking);
                            $('#checkin_no_rkm_medis_cetak').text(data.result.no_rkm_medis);
                            $('#checkin_no_rujukan_cetak').text(data.no_rujukan);
                            $('#checkin_nm_pasien_cetak').text(data.result.nm_pasien);
                            $('#checkin_alamat_cetak').text(data.result.alamat);
                            $('#checkin_tgl_registrasi_cetak').text(data.result.tgl_registrasi);
                            $('#checkin_nm_poli_cetak').text(data.result.nm_poli);
                            $('#checkin_nm_dokter_cetak').text(data.result.nm_dokter);

                            $('#checkin_kdbooking_final').text(no_kodebooking);
                            $('#checkin_tgl_registrasi_final').text(data.result.tgl_registrasi);
                            $('#checkin_jam_reg_final').text(data.result.jam_reg);
                            $('#checkin_no_reg_final').text(data.result.no_reg);
                            $('#checkin_nm_pasien_final').text(data.result.nm_pasien);
                            $('#checkin_no_rujukan_final').text(data.no_rujukan);
                            $('#checkin_no_rkm_medis_final').text(data.result.no_rkm_medis);
                            $('#checkin_alamat_final').text(data.result.alamat);
                            $('#checkin_nm_dokter_final').text(data.result.nm_dokter);
                            $('#checkin_nm_poli_final').text(data.result.nm_poli);
                            $('#checkin_cara_bayar_final').text(caraBayar);

                            $('.progress-bar').css('width', '100%');
                            $('.progress-bar').html('Step 2 of 2');
                            $('#myTab a[href="#reviewPrintCheckin"]').tab('show');
                        } else {
                            alert(data.result);
                            window.location.href = "{?=url('anjungan/pasien')?}";
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(textStatus, errorThrown);
                    }
                });

                setTimeout(function() {
                    window.location.href = "{?=url('anjungan/pasien')?}";
                }, 500000);

            });
            //end of checkin
        });

        $(function() {
            $('#norm')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 6,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 6;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('.norm')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 6,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 6;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('#nobpjs')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 13,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // Prevents direct input in the preview window when true
                    lockInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 13;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('.nobpjs')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 13,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // Prevents direct input in the preview window when true
                    lockInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 13;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('#noktp')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 16,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 16;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('.noktp')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 16,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 6 characters in length
                        return value.length === 16;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('#kdbooking')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 14,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 12 characters in length
                        return value.length === 14;
                    }
                })
                // .addTyping();
        });

        $(function() {
            $('.kdbooking')
                .keyboard({
                    layout: 'custom',
                    customLayout: {
                        'normal': [
                                '7 8 9',
                                '4 5 6',
                                '1 2 3',
                                '0 . {b}',
                                '{accept} {cancel}'
                            ]
                            // 'normal' : [
                            //   '8 9 . {b}',
                            //   '4 5 6 7',
                            //   '0 1 2 3',
                            //   '{accept} {cancel}'
                            // ]
                    },
                    maxLength: 14,
                    // Prevent keys not in the displayed keyboard from being typed in
                    restrictInput: false,
                    // include lower case characters (added v1.25.7)
                    restrictInclude: 'a b c d e f',
                    // don't use combos or A+E could become a ligature
                    useCombos: false,
                    // activate the "validate" callback function
                    acceptValid: true,
                    validate: function(keyboard, value, isClosing) {
                        // only make valid if input is 12 characters in length
                        return value.length === 14;
                    }
                })
                // .addTyping();
        });


       

    </script>

</body>

</html>